<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../stylesheet/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,300;1,400;1,500;1,700&family=Montserrat:ital,wght@0,300;0,500;0,700;1,300;1,500;1,700&display=swap"
        rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,300;1,400;1,500;1,700&family=Montserrat:ital,wght@0,700;1,500;1,700&display=swap"
        rel="stylesheet">
    <title>Pay Page</title>
    <style>
        .success-message {
            color: green;
        }

        .error-message {
            color: red;
        }

        header {
            position: relative;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 0;
        }

        #creditCardForm {
            max-width: 400px;
            /* Đảm bảo form không quá rộng */
            margin: 0 auto;
            /* Canh giữa form */
            padding: 20px;
            background-color: #f9f9f9;
            /* Màu nền cho form */
            border-radius: 8px;
            /* Bo tròn viền của form */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            /* Đổ bóng cho form */
        }

        #creditCardForm label {
            display: block;
            margin-bottom: 8px;
        }

        #creditCardForm input[type="text"] {
            width: calc(100% - 16px);
            /* Đảm bảo ô input không quá rộng và tính cả viền */
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid #ccc;
            /* Viền ô input */
            border-radius: 6px;
            /* Bo tròn góc ô input */
            box-sizing: border-box;
            /* Đảm bảo tính toàn diện của kích thước (bao gồm cả viền và padding) */
        }

        #creditCardForm button[type="submit"] {
            width: 100%;
            /* Nút chiếm toàn bộ chiều rộng của form */
            padding: 12px;
            background-color: #007bff;
            /* Màu nền cho nút thanh toán */
            color: #fff;
            /* Màu chữ của nút */
            border: none;
            /* Xóa viền của nút */
            border-radius: 6px;
            /* Bo tròn góc của nút */
            cursor: pointer;
            /* Con trỏ chuột khi di chuột vào nút */
            transition: background-color 0.3s ease;
            /* Hiệu ứng chuyển đổi màu nền */
        }

        #creditCardForm button[type="submit"]:hover {
            background-color: #0056b3;
            /* Màu nền khi di chuột vào nút */
        }

        #paymentMessage {
            font-size: 16px;
            margin-top: 20px;
        }

        .success-message {
            color: green;
        }

        .error-message {
            color: red;
        }

        #cartItemsContainer {
            margin-bottom: 20px;
        }

        #cartItemsContainer div {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }

        #cartItemsContainer p {
            margin: 5px 0;
        }
    </style>
</head>


<body>
    <header>
        <ul id="left-menu">
            <li><a href="" class="kfc">ve kfc</a><img
                    src="https://images.foody.vn/res/g1/4093/prof/s640x400/image-19f75773-220812162155.jpg" alt=""></li>
            <li><a href="">thuc don</a><img src="img/D7.jpg" alt=""></li>
            <li><a href="">khuyen mai</a><img src="img/D6.jpg" alt=""></li>
            <li><a href="">he thong</a><img src="img/D8.jpg" alt=""></li>
        </ul>
        <div class="logogiua">
            <img src="img/kfc.png" alt="">
        </div>
        <div id="wrapper">
            <div id="main-menu">
                <a href="#"><img src="../images/logo_kfc.jpg" alt="#" id="logo"></a>
                <ul>
                    <li><a href="./datngay.html">Giỏ hàng</a></li>
                    <li><a href="">Search Menu</a></li>
                    <!-- <li><a href="">Giỏ hàng</a></li> -->
                </ul>
            </div>
            <div id="menu-login">
                <ul>
                    <a href=""><i class="fa-solid fa-circle-user"></i></i></a>
                </ul>
                <div class="logo-phone"><img
                        src="https://e7.pngegg.com/pngimages/108/760/png-clipart-kfc-logo-kfc-logo-fast-food-restaurant-chicken-meat-kfc-miscellaneous-food-thumbnail.png"
                        alt=""></div>
                <a href="">
                </a>
            </div>

        </div>
    </header>
    <div id="cartItemsContainer">
        <!-- Các mặt hàng sẽ được hiển thị ở đây -->
    </div>

    <div id="totalAmount">
        <!-- Tổng tiền đơn hàng sẽ được hiển thị ở đây -->
    </div>

    <!-- Form nhập thông tin thẻ tín dụng -->
    <form id="creditCardForm">
        <label for="cardNumber">Số thẻ:</label>
        <input type="text" id="cardNumber" name="cardNumber" placeholder="Nhập số thẻ" required>

        <label for="expiryDate">Ngày hết hạn:</label>
        <input type="text" id="expiryDate" name="expiryDate" placeholder="MM/YY" required>

        <label for="cvv">CVV:</label>
        <input type="text" id="cvv" name="cvv" placeholder="Nhập CVV" required>

        <button type="submit">Thanh toán</button><br><br>
        <div id="paymentMessage"></div>
    </form>

    <script>
        // Gọi router để lấy thông tin giỏ hàng từ server
        const userId = 'user123'; // Thay thế bằng userId thực tế
        fetch(`/api/cart/${userId}`)
            .then(response => response.json())
            .then(cartItems => {
                console.log(cartItems);
                displayCartItems(cartItems);
                displayTotalAmount(cartItems);
            })
            .catch(error => console.error('Lỗi khi lấy thông tin giỏ hàng:', error));

        // Hàm hiển thị các mặt hàng trong giỏ hàng
        function displayCartItems(cartItems) {
            const cartItemsContainer = document.getElementById('cartItemsContainer');

            // Xóa nội dung cũ
            cartItemsContainer.innerHTML = '';

            // Kiểm tra kiểu dữ liệu của cartItems
            if (Array.isArray(cartItems) && cartItems.length > 0) {
                // Nếu cartItems là mảng và không rỗng, sử dụng forEach để lặp qua các mặt hàng
                cartItems.forEach(function (item) {
                    const itemElement = document.createElement('div');
                    itemElement.innerHTML = `
                <p>Product ID: ${item.productId}</p>
                <p>Name: ${item.name}</p>
                <p>Price: ${item.price}$</p>
            `;
                    cartItemsContainer.appendChild(itemElement);
                });
            } else {
                // Nếu không tìm thấy thông tin giỏ hàng hoặc có lỗi, hiển thị thông báo tương ứng
                if (!Array.isArray(cartItems)) {
                    cartItemsContainer.innerHTML = '<p>Lỗi khi lấy thông tin giỏ hàng.</p>';
                } else {
                    cartItemsContainer.innerHTML = '<p>Vui lòng chọn món ăn để đặt hàng!</p>';
                }
            }
        }

        // Hàm hiển thị tổng tiền đơn hàng
        function displayTotalAmount(cartItems) {
            const totalAmountContainer = document.getElementById('totalAmount');

            // Tính tổng số tiền của tất cả các mặt hàng trong giỏ hàng
            const totalAmount = cartItems.reduce((accumulator, currentItem) => accumulator + parseFloat(currentItem.price), 0);

            // Hiển thị tổng số tiền
            totalAmountContainer.innerHTML = `<p>Tổng tiền đơn hàng: ${totalAmount.toFixed(2)}$</p>`;
        }

        // Xử lý sự kiện khi form được submit
        document.getElementById('creditCardForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Ngăn chặn hành động mặc định của form

            // Thực hiện xử lý thanh toán ở đây
            // Giả sử thanh toán thành công
            displayPaymentMessage('Thanh toán thành công, đơn hàng của bạn đang được xác nhận!', 'success');
        });

        // Hàm hiển thị thông báo thanh toán
        function displayPaymentMessage(message, messageType) {
            const paymentMessageContainer = document.getElementById('paymentMessage');

            // Xóa thông báo trước đó (nếu có)
            paymentMessageContainer.innerHTML = '';

            // Tạo một thẻ div để chứa thông báo
            const messageElement = document.createElement('div');
            messageElement.textContent = message;

            // Thiết lập màu sắc cho thông báo dựa vào loại thông báo
            if (messageType === 'success') {
                messageElement.classList.add('success-message');
            } else if (messageType === 'error') {
                messageElement.classList.add('error-message');
            }

            // Thêm thông báo vào container
            paymentMessageContainer.appendChild(messageElement);
        }
    </script>
</body>

</html>